import{_ as Q,a as j,g as K,__tla as X}from"./index-B02nb8ak.js";import{E as v,__tla as Z}from"./element-plus-nwjkU6PL.js";import{b as ee}from"./@vueuse-C2FSle7C.js";import{i as te}from"./echarts-ADakQL4O.js";import{_ as ae,__tla as le}from"./index-QCKGH5kp.js";import{r as y,_ as re,w as ie,b as se,D as me,c as w,W as i,Q as m,F as U,ai as o,o as S,a as k,U as oe,a8 as ne,T as ue,ay as ce,az as de}from"./@vue-Wad96BFw.js";import"./axios-Cm0UX6qg.js";import"./nprogress-D09IqNcY.js";import"./dayjs-Cdlb6j_n.js";import"./lodash-es-DUgYzCpX.js";import"./@element-plus-DsG42htC.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-o_LpjUj1.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BufAhE3Z.js";import"./pinia-BzO-gjbS.js";import"./vue-router-B0KkkPPA.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";let H,pe=Promise.all([(()=>{try{return X}catch{}})(),(()=>{try{return Z}catch{}})(),(()=>{try{return le}catch{}})()]).then(async()=>{let z,N,M,A,L,V,D,C;z=async u=>{try{const{data:s}=await Q.get("/metric",{params:{serviceName:u.serviceName,metricNameLimit:u.metricNameLimit,startTimeStamp:u.startTimeStamp,endTimeStamp:u.endTimeStamp}});return s.code!==null&&s.code===2e3?s:s.code!==null?(v.error(`\u83B7\u53D6\u6570\u503C\u5217\u8868\u5931\u8D25, ${s.message}`),null):(v.error("\u83B7\u53D6\u6570\u503C\u5217\u8868\u5931\u8D25"),null)}catch(s){v.error(`\u83B7\u53D6\u6570\u503C\u5217\u8868\u5931\u8D25, ${s.message}`)}return null},N=u=>(ce("data-v-01c31fe9"),u=u(),de(),u),M=N(()=>k("a",{href:"/main"},"\u4E3B\u9875",-1)),A=N(()=>k("a",{href:"/main/metric"},"\u6570\u503C\u6982\u89C8",-1)),L={class:"search-area"},V={key:0,class:"graph-div"},D=["id"],C={__name:"MetricMain",setup(u){const s=y({serviceName:"",metricNameLimit:0,startTimeStamp:0,endTimeStamp:0}),h=y([]),O=re({lazy:!0,async lazyLoad(e,t){const a=[],{level:n}=e;if(n===0){const r=await j();if(r===null)return;r.result.map(l=>({leaf:!1,value:l,label:l})).forEach(l=>{a.push(l)})}else if(n===1){const r=await K({query:"",namespace:e.value,pageNum:1,pageSize:1e3});if(r===null)return;r.result.data.map(l=>({leaf:!0,value:l.name,label:l.name===""?"null":l.name})).forEach(l=>{a.push(l)})}t(a)}}),_=y(),d=y([{name:"",serviceName:"",metricType:"",metrics:[]}]),B=()=>{_.value&&(s.value.serviceName=_.value[1])},W=async()=>{c&&c.forEach(a=>a.dispose()),d.value=[],b.value=!0;const e=JSON.parse(JSON.stringify(s.value));if(e.serviceName==="null"&&(e.serviceName=""),e.metricNameLimit===0&&(e.metricNameLimit=null),h.value.length===2)e.startTimeStamp=Date.parse(h.value[0]),e.endTimeStamp=Date.parse(h.value[1]);else{v.warning("\u5F53\u524D\u4E3A\u6B63\u5F0F\u73AF\u5883, \u65F6\u95F4\u8303\u56F4\u7F6E\u7A7A\u65F6\u9ED8\u8BA4\u83B7\u53D6\u8FD1\u534A\u4E2A\u5C0F\u65F6\u5185\u7684\u65E5\u5FD7");const a=new Date;e.startTimestamp=a.getTime()-30*60*1e3,e.endTimestamp=a.getTime()}const t=await z(e);if(t!==null)if(t.result&&t.result.length!==0){for(b.value=!1,d.value=t.result;!document.getElementById("metric-graph-"+(d.value.length-1));)await new Promise(a=>setTimeout(a,100));for(let a=0;a<d.value.length;a++)try{I(d.value[a],a)}catch(n){v.error(n)}}else b.value=!0},b=y(!0);let c=[];const f=ee("theme-appearance","auto");ie(f,()=>{c&&c.forEach(e=>e.dispose());for(let e=0;e<d.value.length;e++)try{I(d.value[e],e)}catch(t){v.error(t)}});let T;se(()=>{c&&c.forEach(e=>e.dispose()),window.addEventListener("resize",x),T=new ResizeObserver(()=>x),T.observe(document.getElementById("metricCardRef"))}),me(()=>{window.removeEventListener("resize",x),T.disconnect()});const x=()=>{c&&c.forEach(e=>{e.resize()})},I=(e,t)=>{let a={backgroundColor:f.value==="dark"?"#212224":"#fff",title:{text:e.name.replace(/_/g," "),textStyle:{fontWeight:"bold",fontSize:14,lineHeight:16,width:document.getElementById("metric-graph-"+t).offsetWidth-20,overflow:"break"},subtext:e.metrics[0].description?e.metrics[0].description:"",subtextStyle:{fontSize:10,lineHeight:12,width:document.getElementById("metric-graph-"+t).offsetWidth-20,overflow:"break"}},tooltip:{trigger:"item",axisPointer:{type:"cross"},backgroundColor:f.value==="dark"?"#212224":"#fff",textStyle:{color:f.value==="dark"?"#fff":"#212224"}}};if(e.metricType==="GAUGE"||e.metricType==="COUNTER")e.metrics.length>=2?(a.xAxis={type:"category",data:e.metrics.map(r=>G(r.timestamp))},a.yAxis={type:"value"},a.series=[{data:e.metrics.map(r=>Number(r.value)),type:"line"}]):(console.log(e.metrics[0].value),a.series=[{type:"scatter",symbolSize:1,data:[{value:[0,0],label:{show:!0,formatter:e.metrics[0].value+"",fontSize:20,fontWeight:"bold",color:f.value==="dark"?"#ff0000":"#992233"}}]}],a.xAxis={show:!1,min:-1,max:1},a.yAxis={show:!1,min:-1,max:1});else if(e.metricType==="HISTOGRAM"||e.metricType==="SUMMARY"){let r=[];for(const l in e.metrics[0].buckets)r.push({key:l,value:e.metrics[0].buckets[l]});r.sort((l,p)=>l.key-p.key),a.xAxis={type:"category",data:r.map(l=>l.key)},a.yAxis={type:"value"},a.series=[{data:r.map(l=>Number(l.value)),type:"bar"}]}let n=te(document.getElementById("metric-graph-"+t),f.value==="dark"?"dark":"light");n.setOption(a),c.push(n)},G=e=>{if(e==="0")return"unknown";e.length<13?e=e+"000":e.length>13&&(e=e.substring(0,13)),e=Number(e);let t=new Date(e),a=t.getFullYear()+"-",n=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",r=(t.getDate()<10?"0"+t.getDate():t.getDate())+" ",l=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",p=(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":",E=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return a+n+r+l+p+E};return(e,t)=>{const a=o("el-breadcrumb-item"),n=o("el-breadcrumb"),r=o("el-row"),l=o("el-cascader"),p=o("el-form-item"),E=o("el-input-number"),P=o("el-tooltip"),F=o("el-date-picker"),J=o("el-button"),Y=o("el-form"),$=o("el-divider"),q=o("el-card");return S(),w(U,null,[i(r,null,{default:m(()=>[i(n,{"separator-icon":"ArrowRight"},{default:m(()=>[i(a,null,{default:m(()=>[M]),_:1}),i(a,null,{default:m(()=>[A]),_:1})]),_:1})]),_:1}),i(q,{class:"metric-card",id:"metricCardRef"},{default:m(()=>[k("div",L,[i(Y,{inline:!0,model:s.value,class:"demo-form-inline"},{default:m(()=>[i(p,{label:"\u670D\u52A1\u540D\u79F0"},{default:m(()=>[i(l,{placeholder:"\u8BF7\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u2192\u670D\u52A1\u540D\u79F0",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=g=>_.value=g),clearable:"",props:O,"show-all-levels":!1,onChange:B},null,8,["modelValue","props"])]),_:1}),i(p,{label:"\u56FE\u8868\u6570\u91CF"},{default:m(()=>[i(P,{effect:"light",content:"\u7F6E0\u65F6\u8868\u793A\u641C\u7D22\u670D\u52A1\u4E0B\u6240\u6709\u6570\u503C\u8BB0\u5F55",placement:"top",enterable:!1},{default:m(()=>[i(E,{min:0,modelValue:s.value.metricNameLimit,"onUpdate:modelValue":t[1]||(t[1]=g=>s.value.metricNameLimit=g)},null,8,["modelValue"])]),_:1})]),_:1}),i(p,{label:"\u8D77\u6B62\u65F6\u95F4"},{default:m(()=>[i(F,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=g=>h.value=g),type:"datetimerange","range-separator":"\u5230","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),i(p,null,{default:m(()=>[i(J,{type:"primary",onClick:W},{default:m(()=>[oe("\u641C\u7D22")]),_:1})]),_:1})]),_:1},8,["model"])]),i($),b.value?ue("",!0):(S(),w("div",V,[(S(!0),w(U,null,ne(d.value,(g,R)=>(S(),w("div",{class:"graph-card",key:R},[k("div",{class:"graph-item",id:"metric-graph-"+R},null,8,D)]))),128))]))]),_:1})],64)}}},H=ae(C,[["__scopeId","data-v-01c31fe9"]])});export{pe as __tla,H as default};
