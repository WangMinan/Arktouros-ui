import{_ as Q,a as Y,g as j,__tla as K}from"./index-BVvWotma.js";import{E as w,__tla as X}from"./element-plus-Dn4obzLP.js";import{b as Z}from"./@vueuse-C2FSle7C.js";import{i as ee}from"./echarts-ADakQL4O.js";import{_ as ae,__tla as te}from"./index-DL3sObDm.js";import{r as h,_ as le,w as re,b as ie,c as b,W as i,Q as m,F as H,ai as o,o as y,a as S,U as se,a8 as me,T as I,P as oe,ay as ne,az as ue}from"./@vue-Wad96BFw.js";import"./axios-Cm0UX6qg.js";import"./nprogress-D09IqNcY.js";import"./dayjs-Cdlb6j_n.js";import"./lodash-es-DUgYzCpX.js";import"./@element-plus-DsG42htC.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-o_LpjUj1.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BufAhE3Z.js";import"./pinia-BzO-gjbS.js";import"./vue-router-B0KkkPPA.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";let O,ce=Promise.all([(()=>{try{return K}catch{}})(),(()=>{try{return X}catch{}})(),(()=>{try{return te}catch{}})()]).then(async()=>{let x,N,E,M,V,L,A,z;x=async u=>{try{const{data:s}=await Q.get("/metric",{params:{serviceName:u.serviceName,metricNameLimit:u.metricNameLimit,startTimeStamp:u.startTimeStamp,endTimeStamp:u.endTimeStamp}});return s.code!==null&&s.code===2e3?s:s.code!==null?(w.error(`\u83B7\u53D6\u6570\u503C\u5217\u8868\u5931\u8D25, ${s.message}`),null):(w.error("\u83B7\u53D6\u6570\u503C\u5217\u8868\u5931\u8D25"),null)}catch(s){w.error(`\u83B7\u53D6\u6570\u503C\u5217\u8868\u5931\u8D25, ${s.message}`)}return null},N=u=>(ne("data-v-30f92040"),u=u(),ue(),u),E=N(()=>S("a",{href:"/main"},"\u4E3B\u9875",-1)),M=N(()=>S("a",{href:"/main/metric"},"\u6570\u503C\u6982\u89C8",-1)),V={class:"search-area"},L={key:0,class:"graph-div"},A=["id"],z={__name:"MetricMain",setup(u){const s=h({serviceName:"",metricNameLimit:0,startTimeStamp:0,endTimeStamp:0}),v=h([]),P=le({lazy:!0,async lazyLoad(e,a){const t=[],{level:n}=e;if(n===0){const r=await Y();if(r===null)return;r.result.map(l=>({leaf:!1,value:l,label:l})).forEach(l=>{t.push(l)})}else if(n===1){const r=await j({query:"",namespace:e.value,pageNum:1,pageSize:1e3});if(r===null)return;r.result.data.map(l=>({leaf:!0,value:l.name,label:l.name===""?"null":l.name})).forEach(l=>{t.push(l)})}a(t)}}),_=h(),d=h([{name:"",serviceName:"",metricType:"",metrics:[]}]),G=()=>{_.value&&(s.value.serviceName=_.value[1])},B=async()=>{f&&f.forEach(t=>t.dispose());const e=JSON.parse(JSON.stringify(s.value));e.serviceName==="null"&&(e.serviceName=""),e.metricNameLimit===0&&(e.metricNameLimit=null),v.value.length===2?(e.startTimeStamp=Date.parse(v.value[0]),e.endTimeStamp=Date.parse(v.value[1])):(e.startTimeStamp=null,e.endTimeStamp=null);const a=await x(e);if(a!==null)if(a.result&&a.result.length!==0){for(k.value=!1,d.value=a.result;!document.getElementById("metric-graph-"+(d.value.length-1));)await new Promise(t=>setTimeout(t,100));for(let t=0;t<d.value.length;t++)try{D(d.value[t],t)}catch(n){console.error(n)}}else k.value=!0},k=h(!0);let f=[];const g=Z("theme-appearance","auto");re(g,()=>{f&&f.forEach(e=>e.dispose());for(let e=0;e<d.value.length;e++)try{D(d.value[e],e)}catch(a){console.error(a)}}),ie(()=>{f&&f.forEach(e=>e.dispose())});const D=(e,a)=>{let t={backgroundColor:g.value==="dark"?"#212224":"#fff",title:{text:e.name,textStyle:{fontWeight:"normal",fontSize:12},subtext:"service: "+e.serviceName,subtextStyle:{fontSize:10}},tooltip:{trigger:"item",axisPointer:{type:"cross"},backgroundColor:g.value==="dark"?"#212224":"#fff",textStyle:{color:g.value==="dark"?"#fff":"#212224"}}};if(e.metricType==="GAUGE")t.xAxis={type:"category",data:e.metrics.map(r=>F(r.timestamp))},t.yAxis={type:"value"},t.series=[{data:e.metrics.map(r=>Number(r.value)),type:"line"}];else if(e.metricType==="HISTOGRAM"){let r=[];for(const l in e.metrics[0].buckets)r.push({key:l,value:e.metrics[0].buckets[l]});r.sort((l,c)=>l.key-c.key),t.xAxis={type:"category",data:r.map(l=>l.key)},t.yAxis={type:"value"},t.series=[{data:r.map(l=>Number(l.value)),type:"bar"}]}let n=ee(document.getElementById("metric-graph-"+a),g.value==="dark"?"dark":"light");n.setOption(t),f.push(n)},F=e=>{if(e==="0")return"unknown";e.length<13?e=e+"000":e.length>13&&(e=e.substring(0,13)),e=Number(e);let a=new Date(e),t=a.getFullYear()+"-",n=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",r=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ",l=(a.getHours()<10?"0"+a.getHours():a.getHours())+":",c=(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())+":",T=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return t+n+r+l+c+T};return(e,a)=>{const t=o("el-breadcrumb-item"),n=o("el-breadcrumb"),r=o("el-row"),l=o("el-cascader"),c=o("el-form-item"),T=o("el-input-number"),U=o("el-tooltip"),J=o("el-date-picker"),R=o("el-button"),W=o("el-form"),$=o("el-divider"),q=o("el-card");return y(),b(H,null,[i(r,null,{default:m(()=>[i(n,{"separator-icon":"ArrowRight"},{default:m(()=>[i(t,null,{default:m(()=>[E]),_:1}),i(t,null,{default:m(()=>[M]),_:1})]),_:1})]),_:1}),i(q,{class:"metric-card"},{default:m(()=>[S("div",V,[i(W,{inline:!0,model:s.value,class:"demo-form-inline"},{default:m(()=>[i(c,{label:"\u670D\u52A1\u540D\u79F0"},{default:m(()=>[i(l,{placeholder:"\u8BF7\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u2192\u670D\u52A1\u540D\u79F0",modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=p=>_.value=p),clearable:"",props:P,"show-all-levels":!1,onChange:G},null,8,["modelValue","props"])]),_:1}),i(c,{label:"\u56FE\u8868\u6570\u91CF"},{default:m(()=>[i(U,{effect:"light",content:"\u7F6E0\u65F6\u8868\u793A\u641C\u7D22\u670D\u52A1\u4E0B\u6240\u6709\u6570\u503C\u8BB0\u5F55",placement:"top",enterable:!1},{default:m(()=>[i(T,{min:0,modelValue:s.value.metricNameLimit,"onUpdate:modelValue":a[1]||(a[1]=p=>s.value.metricNameLimit=p)},null,8,["modelValue"])]),_:1})]),_:1}),i(c,{label:"\u8D77\u6B62\u65F6\u95F4"},{default:m(()=>[i(J,{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=p=>v.value=p),type:"datetimerange","range-separator":"\u5230","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),i(c,null,{default:m(()=>[i(R,{type:"primary",onClick:B},{default:m(()=>[se("\u641C\u7D22")]),_:1})]),_:1})]),_:1},8,["model"])]),i($),k.value?I("",!0):(y(),b("div",L,[(y(!0),b(H,null,me(d.value,(p,C)=>(y(),b("div",{class:"graph-card",key:C},[p.metrics[0]?(y(),oe(U,{key:0,effect:"light",content:p.metrics[0].description,placement:"top",enterable:!1},{default:m(()=>[S("div",{class:"graph-item",id:"metric-graph-"+C},null,8,A)]),_:2},1032,["content"])):I("",!0)]))),128))]))]),_:1})],64)}}},O=ae(z,[["__scopeId","data-v-30f92040"]])});export{ce as __tla,O as default};
