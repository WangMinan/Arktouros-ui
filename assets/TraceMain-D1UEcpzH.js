import{_ as M,a as ie,g as se,__tla as ce}from"./index-D9nBPGMF.js";import{E as h,__tla as pe}from"./element-plus-k3hzl6Qv.js";import{b as de}from"./@vueuse-D5W2k7is.js";import{i as me}from"./echarts-ADakQL4O.js";import{u as ve}from"./vue-router-B8w0HFRn.js";import{_ as ge,__tla as fe}from"./index-CluLEf10.js";import{r as _,_ as C,b as ye,w as he,c as Q,W as e,Q as u,ai as r,o as E,a as p,F as _e,a8 as be,u as ze,P as Ne,ay as we,az as Ie}from"./@vue-Bf153t-p.js";import"./axios-Cm0UX6qg.js";import"./nprogress-D09IqNcY.js";import"./dayjs-Cdlb6j_n.js";import"./lodash-es-DUgYzCpX.js";import"./@element-plus-dc1tp9Sj.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-o_LpjUj1.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BufAhE3Z.js";import"./pinia-uoLhQquL.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";let j,Re=Promise.all([(()=>{try{return ce}catch{}})(),(()=>{try{return pe}catch{}})(),(()=>{try{return fe}catch{}})()]).then(async()=>{let P,k,b,V,A,U,$,x,B,D,O,T,W;P=async i=>{try{const{data:a}=await M.get("/trace/endPoints",{params:{serviceName:i.serviceName,pageNum:i.pageNum,pageSize:i.pageSize}});return a.code!==null&&a.code===2e3?a:a.code!==null?(h.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${a.message}`),null):(h.error("\u83B7\u53D6traceId\u8868\u5931\u8D25"),null)}catch(a){h.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${a.message}`)}return null},k=async i=>{try{const{data:a}=await M.get("/trace/topology",{params:{traceId:i}});return a.code!==null&&a.code===2e3?a:a.code!==null?(h.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${a.message}`),null):(h.error("\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25"),null)}catch(a){h.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${a.message}`)}return null},b=i=>(we("data-v-3ef35dab"),i=i(),Ie(),i),V={class:"trace-main-container"},A=b(()=>p("a",{href:"/main"},"\u4E3B\u9875",-1)),U=b(()=>p("a",{href:"/main/trace"},"\u94FE\u8DEF\u4FE1\u606F",-1)),$={class:"cascader-div"},x=b(()=>p("div",null,"\u8FFD\u8E2A\u7AEF\u70B9\u4FE1\u606F",-1)),B={class:"endpoint-div"},D={class:"table-div"},O={class:"pagination-div"},T=b(()=>p("div",{id:"trace-topology-div"},null,-1)),W={__name:"TraceMain",setup(i){const a=_(),s=ve(),G=C({lazy:!0,async lazyLoad(l,t){const y=[],{level:I}=l;if(I===0){const d=await ie();if(d===null)return;d.result.map(n=>({leaf:!1,value:n,label:n})).forEach(n=>{y.push(n)})}else if(I===1){const d=await se({query:"",namespace:l.value,pageNum:1,pageSize:1e3});if(d===null)return;d.result.data.map(n=>({leaf:!0,value:n.name,label:n.name===""?"null":n.name})).forEach(n=>{y.push(n)})}t(y)}}),c=C({serviceName:"",pageNum:1,pageSize:10});ye(async()=>{s.currentRoute.value.query.serviceName&&(c.serviceName=s.currentRoute.value.query.serviceName,a.value=s.currentRoute.value.query.serviceName,await N()),s.currentRoute.value.query.traceId&&(v.value.includes(s.currentRoute.value.query.traceId)||v.value.push(s.currentRoute.value.query.traceId),m.value=s.currentRoute.value.query.traceId),s.currentRoute.value.query.serviceName&&s.currentRoute.value.query.traceId&&S()});const R=_(0),N=async()=>{g.value.splice(0,g.value.length),w.splice(0,w.length),R.value=0,f&&f.dispose(),v.value=[],m.value="",c.serviceName=a.value[1];const l=await P(c);l!==null&&(R.value=l.result.length,l.result.forEach(t=>{g.value.push(t)}),g.value.forEach(t=>{w.push(t.endPoint)}),v.value=g.value[0].traceIds)};let v=_([]);const g=_([{endPoint:{},traceIds:[]}]),w=C([]),H=async l=>{c.pageSize=l,await N()},J=async l=>{c.pageNum=l,await N()},K=l=>{g.value.forEach(t=>{t.endPoint===l&&(v.value=t.traceIds)})},m=_(),F=_({name:"",value:"",collapsed:!1,children:[]}),X=async()=>{if(m.value===""||m.value===void 0)return;const l=await k(m.value);l!==null&&(F.value=l.result,S())};let f;const q=de("theme-appearance","auto");he(q,()=>{f&&f.dispose(),S()});const S=()=>{let l={backgroundColor:q.value==="dark"?"#212224":"#fff",tooltip:{trigger:"item",triggerOn:"mousemove"},series:[{type:"tree",symbol:"circle",roam:!0,expandAndCollapse:!0,animationDuration:550,animationDurationUpdate:750,label:{position:"left",verticalAlign:"middle",align:"right",fontSize:9},leaves:{label:{position:"right",verticalAlign:"middle",align:"left"}},data:[F.value]}]};f=me(document.getElementById("trace-topology-div"),q.value==="dark"?"dark":"light"),f.setOption(l)};return(l,t)=>{const y=r("el-breadcrumb-item"),I=r("el-breadcrumb"),d=r("el-row"),n=r("el-cascader"),Y=r("el-divider"),z=r("el-table-column"),Z=r("ArrowRightBold"),ee=r("el-icon"),ae=r("el-button"),le=r("el-tooltip"),te=r("el-table"),re=r("el-pagination"),L=r("el-col"),ue=r("el-option"),oe=r("el-select"),ne=r("el-card");return E(),Q("div",V,[e(d,null,{default:u(()=>[e(I,{"separator-icon":"ArrowRight"},{default:u(()=>[e(y,null,{default:u(()=>[A]),_:1}),e(y,null,{default:u(()=>[U]),_:1})]),_:1})]),_:1}),e(ne,{class:"table-card"},{default:u(()=>[p("div",$,[e(n,{placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u670D\u52A1",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value=o),style:{width:"40%"},clearable:"",props:G,"show-all-levels":!1,onChange:N},null,8,["modelValue","props"])]),e(Y),e(d,{gutter:10,style:{"margin-top":"2%"}},{default:u(()=>[e(L,{span:8},{default:u(()=>[x,p("div",B,[p("div",D,[e(te,{data:w,stripe:""},{default:u(()=>[e(z,{prop:"serviceName",label:"\u670D\u52A1\u540D\u79F0"}),e(z,{prop:"ip",label:"IP\u5730\u5740"}),e(z,{prop:"port",label:"\u7AEF\u53E3\u53F7"}),e(z,{prop:"latency",label:"\u65F6\u5EF6"}),e(z,{fixed:"right",label:"\u7ED8\u56FE"},{default:u(o=>[e(le,{effect:"light",content:"\u67E5\u770BEndpoint\u6240\u5728\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:u(()=>[e(ae,{type:"primary",circle:"",size:"small",onClick:qe=>K(o.row)},{default:u(()=>[e(ee,null,{default:u(()=>[e(Z)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),p("div",O,[e(re,{"current-page":c.pageNum,"onUpdate:currentPage":t[1]||(t[1]=o=>c.pageNum=o),"page-size":c.pageSize,"onUpdate:pageSize":t[2]||(t[2]=o=>c.pageSize=o),"page-sizes":[2,5,10,20],layout:"total, pager, sizes",total:R.value,"pager-count":5,onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])])])]),_:1}),e(L,{span:16},{default:u(()=>[p("div",null,[e(oe,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=o=>m.value=o),placeholder:"\u8BF7\u5728\u5DE6\u4FA7\u9009\u62E9Endpoint\u540E\uFF0C\u9009\u62E9TraceId",style:{width:"40%"},clearable:"",onChange:X},{default:u(()=>[(E(!0),Q(_e,null,be(ze(v),o=>(E(),Ne(ue,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),T]),_:1})]),_:1})]),_:1})])}}},j=ge(W,[["__scopeId","data-v-3ef35dab"]])});export{Re as __tla,j as default};
