import{_ as j,a as pe,g as me,__tla as ve}from"./index-BBwaYWlT.js";import{E as _,__tla as ge}from"./element-plus-CHAcCvkm.js";import{b as fe}from"./@vueuse-CYo6n33K.js";import{i as ye}from"./echarts-DvxK4-OB.js";import{u as he}from"./vue-router-BPiurYaj.js";import{_ as _e,__tla as be}from"./index-D1Tzy93z.js";import{r as b,_ as q,b as we,D as ze,w as Ie,c as G,W as e,Q as o,ai as r,o as P,a as c,F as Ne,a8 as Se,u as Ee,P as Re,ay as Ce,az as ke}from"./@vue-CIN5rAIq.js";import"./axios-B4uVmeYG.js";import"./nprogress-D09IqNcY.js";import"./dayjs-Cdlb6j_n.js";import"./lodash-es-D0J8aJCM.js";import"./@element-plus-DDQhs22L.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-B_wA2iF0.js";import"./tslib-BDyQ-Jie.js";import"./zrender-B3govljg.js";import"./pinia-C3d5II23.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";let H,qe=Promise.all([(()=>{try{return ve}catch{}})(),(()=>{try{return ge}catch{}})(),(()=>{try{return be}catch{}})()]).then(async()=>{let V,A,g,U,x,$,B,D,L,O,T,F,K,M;V=async s=>{try{const{data:u}=await j.get("/trace/endPoints",{params:{serviceName:s.serviceName,pageNum:s.pageNum,pageSize:s.pageSize}});return u.code!==null&&u.code===2e3?u:u.code!==null?(_.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${u.message}`),null):(_.error("\u83B7\u53D6traceId\u8868\u5931\u8D25"),null)}catch(u){_.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${u.message}`)}return null},A=async(s,u)=>{try{const{data:l}=await j.get("/trace/topology",{params:{traceId:s,serviceName:u}});return l.code!==null&&l.code===2e3?l:l.code!==null?(_.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${l.message}`),null):(_.error("\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25"),null)}catch(l){_.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${l.message}`)}return null},g=s=>(Ce("data-v-ffff5844"),s=s(),ke(),s),U={class:"trace-main-container"},x=g(()=>c("a",{href:"/main"},"\u4E3B\u9875",-1)),$=g(()=>c("a",{href:"/main/trace"},"\u94FE\u8DEF\u4FE1\u606F",-1)),B={class:"cascader-div"},D=g(()=>c("div",null,"\u8FFD\u8E2A\u7AEF\u70B9\u4FE1\u606F",-1)),L={class:"endpoint-div"},O={class:"table-div"},T={class:"pagination-div"},F=g(()=>c("div",null,"Span\u8C03\u7528\u56FE",-1)),K=g(()=>c("div",{id:"trace-topology-div"},null,-1)),M={__name:"TraceMain",setup(s){const u=b(),l=he(),J=q({lazy:!0,async lazyLoad(a,t){const h=[],{level:S}=a;if(S===0){const m=await pe();if(m===null)return;m.result.map(i=>({leaf:!1,value:i,label:i})).forEach(i=>{h.push(i)})}else if(S===1){const m=await me({query:"",namespace:a.value,pageNum:1,pageSize:1e3});if(m===null)return;m.result.data.map(i=>({leaf:!0,value:i.name,label:i.name===""?"null":i.name})).forEach(i=>{h.push(i)})}t(h)}}),d=q({serviceName:"",pageNum:1,pageSize:10});let E;const R=()=>{p&&p.resize()};we(async()=>{l.currentRoute.value.query.serviceName&&(d.serviceName=l.currentRoute.value.query.serviceName,u.value=l.currentRoute.value.query.serviceName,await I()),l.currentRoute.value.query.traceId&&(f.value.includes(l.currentRoute.value.query.traceId)||f.value.push(l.currentRoute.value.query.traceId),v.value=l.currentRoute.value.query.traceId),l.currentRoute.value.query.serviceName&&l.currentRoute.value.query.traceId&&k(),window.addEventListener("resize",R),E=new ResizeObserver(()=>R),E.observe(document.getElementById("trace-topology-div"))}),ze(()=>{window.removeEventListener("resize",R),E.disconnect()});const C=b(0),I=async()=>{y.value.splice(0,y.value.length),N.splice(0,N.length),C.value=0,p&&p.dispose(),f.value=[],v.value="",d.serviceName=u.value[1];const a=await V(d);a!==null&&(C.value=a.result.length,a.result.forEach(t=>{y.value.push(t)}),y.value.forEach(t=>{N.push(t.endPoint)}),f.value=y.value[0].traceIds)};let f=b([]);const y=b([{endPoint:{},traceIds:[]}]),N=q([]),X=async a=>{d.pageSize=a,await I()},Y=async a=>{d.pageNum=a,await I()},Z=a=>{y.value.forEach(t=>{t.endPoint===a&&(f.value=t.traceIds)})},v=b(),Q=b({name:"",value:"",collapsed:!1,children:[]}),ee=async()=>{if(v.value===""||v.value===void 0)return;const a=await A(v.value,u.value[1]);a!==null&&(Q.value=a.result,k())};let p;const w=fe("theme-appearance","auto");Ie(w,()=>{k()});const k=()=>{p&&p.dispose();let a={backgroundColor:w.value==="dark"?"#212224":"#fff",tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:w.value==="dark"?"#212224":"#fff",textStyle:{color:w.value==="dark"?"#fff":"#212224"}},series:[{type:"tree",symbol:"circle",roam:!0,expandAndCollapse:!0,animationDuration:550,animationDurationUpdate:750,label:{position:"left",verticalAlign:"middle",align:"right",fontSize:9},leaves:{label:{position:"right",verticalAlign:"middle",align:"left"}},data:[Q.value]}]};p=ye(document.getElementById("trace-topology-div"),w.value==="dark"?"dark":"light"),p.setOption(a)};return(a,t)=>{const h=r("el-breadcrumb-item"),S=r("el-breadcrumb"),m=r("el-row"),i=r("el-cascader"),ae=r("el-divider"),z=r("el-table-column"),le=r("ArrowRightBold"),te=r("el-icon"),re=r("el-button"),ue=r("el-tooltip"),oe=r("el-table"),ne=r("el-pagination"),W=r("el-col"),ie=r("el-option"),se=r("el-select"),ce=r("el-form-item"),de=r("el-card");return P(),G("div",U,[e(m,null,{default:o(()=>[e(S,{"separator-icon":"ArrowRight"},{default:o(()=>[e(h,null,{default:o(()=>[x]),_:1}),e(h,null,{default:o(()=>[$]),_:1})]),_:1})]),_:1}),e(de,{class:"table-card"},{default:o(()=>[c("div",B,[e(i,{placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u670D\u52A1",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),style:{width:"40%"},clearable:"",props:J,"show-all-levels":!1,onChange:I},null,8,["modelValue","props"])]),e(ae),e(m,{gutter:10,style:{"margin-top":"2%"}},{default:o(()=>[e(W,{span:8},{default:o(()=>[D,c("div",L,[c("div",O,[e(oe,{data:N,stripe:""},{default:o(()=>[e(z,{prop:"serviceName",label:"\u670D\u52A1\u540D\u79F0"}),e(z,{prop:"ip",label:"IP\u5730\u5740"}),e(z,{prop:"port",label:"\u7AEF\u53E3\u53F7"}),e(z,{prop:"latency",label:"\u65F6\u5EF6"}),e(z,{fixed:"right",label:"\u7ED8\u56FE"},{default:o(n=>[e(ue,{effect:"light",content:"\u67E5\u770BEndpoint\u6240\u5728\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:o(()=>[e(re,{type:"primary",circle:"",size:"small",onClick:Pe=>Z(n.row)},{default:o(()=>[e(te,null,{default:o(()=>[e(le)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),c("div",T,[e(ne,{"current-page":d.pageNum,"onUpdate:currentPage":t[1]||(t[1]=n=>d.pageNum=n),"page-size":d.pageSize,"onUpdate:pageSize":t[2]||(t[2]=n=>d.pageSize=n),"page-sizes":[2,5,10,20],layout:"total, pager, sizes",total:C.value,"pager-count":5,onSizeChange:X,onCurrentChange:Y},null,8,["current-page","page-size","total"])])])]),_:1}),e(W,{span:16},{default:o(()=>[c("div",null,[F,e(ce,{label:"TraceId"},{default:o(()=>[e(se,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=n=>v.value=n),placeholder:"\u8BF7\u5728\u5DE6\u4FA7\u9009\u62E9Endpoint\u540E\uFF0C\u9009\u62E9TraceId",style:{width:"40%"},clearable:"",onChange:ee},{default:o(()=>[(P(!0),G(Ne,null,Se(Ee(f),n=>(P(),Re(ie,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),K]),_:1})]),_:1})]),_:1})])}}},H=_e(M,[["__scopeId","data-v-ffff5844"]])});export{qe as __tla,H as default};
