import{_ as H,a as se,g as ce,__tla as ie}from"./index-C6HjEeQ9.js";import{H as h,g as _,v as de,B as S,j as pe,C as ve,G as me,D as ge,n as L,l as e,w as u,r,o as k,k as d,F as fe,I as ye,A as he,c as _e,q as be,u as ze,__tla as Ie}from"./.pnpm-BUSZVuX4.js";import{_ as Ne,__tla as we}from"./index-1_e2lE3f.js";let M,qe=Promise.all([(()=>{try{return ie}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return we}catch{}})()]).then(async()=>{let E,P,b,A,V,U,$,x,B,D,O,T,j;E=async s=>{try{const{data:a}=await H.get("/trace/endPoints",{params:{serviceName:s.serviceName,pageNum:s.pageNum,pageSize:s.pageSize}});return a.code!==null&&a.code===2e3?a:a.code!==null?(h.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${a.message}`),null):(h.error("\u83B7\u53D6traceId\u8868\u5931\u8D25"),null)}catch(a){h.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${a.message}`)}return null},P=async s=>{try{const{data:a}=await H.get("/trace/topology",{params:{traceId:s}});return a.code!==null&&a.code===2e3?a:a.code!==null?(h.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${a.message}`),null):(h.error("\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25"),null)}catch(a){h.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${a.message}`)}return null},b=s=>(be("data-v-3ef35dab"),s=s(),ze(),s),A={class:"trace-main-container"},V=b(()=>d("a",{href:"/main"},"\u4E3B\u9875",-1)),U=b(()=>d("a",{href:"/main/trace"},"\u94FE\u8DEF\u4FE1\u606F",-1)),$={class:"cascader-div"},x=b(()=>d("div",null,"\u8FFD\u8E2A\u7AEF\u70B9\u4FE1\u606F",-1)),B={class:"endpoint-div"},D={class:"table-div"},O={class:"pagination-div"},T=b(()=>d("div",{id:"trace-topology-div"},null,-1)),j={__name:"TraceMain",setup(s){const a=_(),c=de(),J=S({lazy:!0,async lazyLoad(l,t){const y=[],{level:w}=l;if(w===0){const p=await se();if(p===null)return;p.result.map(o=>({leaf:!1,value:o,label:o})).forEach(o=>{y.push(o)})}else if(w===1){const p=await ce({query:"",namespace:l.value,pageNum:1,pageSize:1e3});if(p===null)return;p.result.data.map(o=>({leaf:!0,value:o.name,label:o.name===""?"null":o.name})).forEach(o=>{y.push(o)})}t(y)}}),i=S({serviceName:"",pageNum:1,pageSize:10});pe(async()=>{c.currentRoute.value.query.serviceName&&(i.serviceName=c.currentRoute.value.query.serviceName,a.value=c.currentRoute.value.query.serviceName,await I()),c.currentRoute.value.query.traceId&&(m.value.includes(c.currentRoute.value.query.traceId)||m.value.push(c.currentRoute.value.query.traceId),v.value=c.currentRoute.value.query.traceId),c.currentRoute.value.query.serviceName&&c.currentRoute.value.query.traceId&&C()});const q=_(0),I=async()=>{g.value.splice(0,g.value.length),N.splice(0,N.length),q.value=0,f&&f.dispose(),m.value=[],v.value="",i.serviceName=a.value[1];const l=await E(i);l!==null&&(q.value=l.result.length,l.result.forEach(t=>{g.value.push(t)}),g.value.forEach(t=>{N.push(t.endPoint)}),m.value=g.value[0].traceIds)};let m=_([]);const g=_([{endPoint:{},traceIds:[]}]),N=S([]),K=async l=>{i.pageSize=l,await I()},Q=async l=>{i.pageNum=l,await I()},W=l=>{g.value.forEach(t=>{t.endPoint===l&&(m.value=t.traceIds)})},v=_(),F=_({name:"",value:"",collapsed:!1,children:[]}),X=async()=>{if(v.value===""||v.value===void 0)return;const l=await P(v.value);l!==null&&(F.value=l.result,C())};let f;const R=ve("theme-appearance","auto");me(R,()=>{f&&f.dispose(),C()});const C=()=>{let l={backgroundColor:R.value==="dark"?"#212224":"#fff",tooltip:{trigger:"item",triggerOn:"mousemove"},series:[{type:"tree",symbol:"circle",roam:!0,expandAndCollapse:!0,animationDuration:550,animationDurationUpdate:750,label:{position:"left",verticalAlign:"middle",align:"right",fontSize:9},leaves:{label:{position:"right",verticalAlign:"middle",align:"left"}},data:[F.value]}]};f=ge(document.getElementById("trace-topology-div"),R.value==="dark"?"dark":"light"),f.setOption(l)};return(l,t)=>{const y=r("el-breadcrumb-item"),w=r("el-breadcrumb"),p=r("el-row"),o=r("el-cascader"),Y=r("el-divider"),z=r("el-table-column"),Z=r("ArrowRightBold"),ee=r("el-icon"),ae=r("el-button"),le=r("el-tooltip"),te=r("el-table"),re=r("el-pagination"),G=r("el-col"),ue=r("el-option"),ne=r("el-select"),oe=r("el-card");return k(),L("div",A,[e(p,null,{default:u(()=>[e(w,{"separator-icon":"ArrowRight"},{default:u(()=>[e(y,null,{default:u(()=>[V]),_:1}),e(y,null,{default:u(()=>[U]),_:1})]),_:1})]),_:1}),e(oe,{class:"table-card"},{default:u(()=>[d("div",$,[e(o,{placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u670D\u52A1",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=n=>a.value=n),style:{width:"40%"},clearable:"",props:J,"show-all-levels":!1,onChange:I},null,8,["modelValue","props"])]),e(Y),e(p,{gutter:10,style:{"margin-top":"2%"}},{default:u(()=>[e(G,{span:8},{default:u(()=>[x,d("div",B,[d("div",D,[e(te,{data:N,stripe:""},{default:u(()=>[e(z,{prop:"serviceName",label:"\u670D\u52A1\u540D\u79F0"}),e(z,{prop:"ip",label:"IP\u5730\u5740"}),e(z,{prop:"port",label:"\u7AEF\u53E3\u53F7"}),e(z,{prop:"latency",label:"\u65F6\u5EF6"}),e(z,{fixed:"right",label:"\u7ED8\u56FE"},{default:u(n=>[e(le,{effect:"light",content:"\u67E5\u770BEndpoint\u6240\u5728\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:u(()=>[e(ae,{type:"primary",circle:"",size:"small",onClick:Re=>W(n.row)},{default:u(()=>[e(ee,null,{default:u(()=>[e(Z)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),d("div",O,[e(re,{"current-page":i.pageNum,"onUpdate:currentPage":t[1]||(t[1]=n=>i.pageNum=n),"page-size":i.pageSize,"onUpdate:pageSize":t[2]||(t[2]=n=>i.pageSize=n),"page-sizes":[2,5,10,20],layout:"total, pager, sizes",total:q.value,"pager-count":5,onSizeChange:K,onCurrentChange:Q},null,8,["current-page","page-size","total"])])])]),_:1}),e(G,{span:16},{default:u(()=>[d("div",null,[e(ne,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=n=>v.value=n),placeholder:"\u8BF7\u5728\u5DE6\u4FA7\u9009\u62E9Endpoint\u540E\uFF0C\u9009\u62E9TraceId",style:{width:"40%"},clearable:"",onChange:X},{default:u(()=>[(k(!0),L(fe,null,ye(he(m),n=>(k(),_e(ue,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),T]),_:1})]),_:1})]),_:1})])}}},M=Ne(j,[["__scopeId","data-v-3ef35dab"]])});export{qe as __tla,M as default};
